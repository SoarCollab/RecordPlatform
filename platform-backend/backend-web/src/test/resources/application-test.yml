# Test environment configuration
# Database, Redis, RabbitMQ are provided by TestContainers

spring:
  application:
    name: backend-web-test

  # Exclude Dubbo auto-configuration to prevent @DubboReference from attempting registry lookup
  autoconfigure:
    exclude:
      - org.apache.dubbo.spring.boot.autoconfigure.DubboAutoConfiguration
      - org.apache.dubbo.spring.boot.autoconfigure.DubboListenerAutoConfiguration
      - org.apache.dubbo.spring.boot.autoconfigure.DubboRelaxedBinding2AutoConfiguration
      - org.apache.dubbo.spring.boot.autoconfigure.DubboTripleAutoConfiguration

  cloud:
    nacos:
      config:
        enabled: false
      discovery:
        enabled: false

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    # URL, username, password are set by TestContainers DynamicPropertySource

  flyway:
    enabled: true
    locations: classpath:db/migration
    clean-on-validation-error: true

  data:
    redis:
      timeout: 5000ms
      # Host, port are set by TestContainers DynamicPropertySource

  rabbitmq:
    virtual-host: /
    # Host, port are set by TestContainers DynamicPropertySource
    listener:
      simple:
        auto-startup: false
      direct:
        auto-startup: false

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=10m

  # Mail username for MailQueueListener (JavaMailSender is mocked)
  mail:
    username: test@example.com

  security:
    jwt:
      key: ci-integration-jwt-key-32chars-xK9mN2pL5qR8vW3y
      expire: 1

# Disable Dubbo registry for tests (mock external services)
dubbo:
  registry:
    address: N/A
  consumer:
    check: false

# Logging configuration for tests
logging:
  level:
    cn.flying: INFO
    org.springframework.test: INFO
    org.testcontainers: INFO
    com.github.dockerjava: WARN

# Disable scheduled tasks in tests
spring.task.scheduling.pool.size: 0

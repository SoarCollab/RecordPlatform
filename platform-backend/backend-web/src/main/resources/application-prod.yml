server:
  port: 80
  servlet:
    context-path: /record-platform
spring:
  # Flyway 生产环境配置
  flyway:
    enabled: true
    baseline-on-migrate: false
    clean-disabled: true

  datasource:
    druid:
      type: com.alibaba.druid.pool.DruidDataSource
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:RecordPlatform}?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&useSSL=false
      username: ${spring.datasource.username}
      password: ${spring.datasource.password}
      initialSize: 5
      minIdle: 5
      maxActive: 40
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: /druid/*,*.js,*.css,*.gif,*.jpg,*.bmp,*.png,*.ico
      stat-view-servlet:
        enabled: false  # 生产环境禁用 Druid 监控页面
        url-pattern: /druid/*
        allow:
        deny:
        reset-enable: false
        login-username: ${DRUID_USERNAME:admin}
        login-password: ${DRUID_PASSWORD}

  mail:
    host: ${spring.mail.host}
    username: ${spring.mail.username}
    password: ${spring.mail.password}
    port: 465
    properties:
      from: ${spring.mail.username}
      mail:
        smtp:
          socketFactory:
            class: javax.net.ssl.SSLSocketFactory
  rabbitmq:
    addresses: ${spring.rabbitmq.addresses}
    username: ${spring.rabbitmq.username}
    password: ${spring.rabbitmq.password}
  data:
    redis:
      database: 0
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      timeout: 5000
      username: ${spring.data.redis.username}
      password: ${spring.data.redis.password}
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${minio.access-key}
  secret-key: ${minio.secret-key}
  bucket-name: forum

# dubbo配置
dubbo:
  application:
    name: RecordPlatform_Main
    logger: slf4j
    qos-port: 22330
    check-serializable: false
    protocol: tri
  protocol: # Dubbo 协议配置
    name: tri   # 使用 Triple 协议
    payload: 104857600 # 将最大载荷大小设置为 100MB (100 * 1024 * 1024 bytes)
  registry:
    register-mode: instance
    address: nacos://localhost:8848?username=${nacos.username}&password=${nacos.password}
  consumer:
    timeout: 30000 # 全局消费者超时设置为30秒
    references:
      cn.flying.platformapi.external.DistributedStorageService: # 这是interface的简单名称，或者全限定名
        methods:
          - name: storeFile
            timeout: 60000 # 将 storeFile 方法的超时时间设置为 60000ms (60秒)
            retries: 0 # 文件存储操作通常不建议重试，除非有幂等性保证且业务允许

# 日志配置
logging:
  level:
    root: WARN  # 全局日志级别保持为WARN

# 生产环境禁用 API 文档
knife4j:
  production: true  # 生产环境屏蔽所有 Swagger 相关资源